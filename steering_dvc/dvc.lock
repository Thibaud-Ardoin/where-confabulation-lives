schema: '2.0'
stages:
  steering:
    cmd: torchrun ../src/steering_inference.py
    deps:
    - path: ../data/features
      hash: md5
      md5: d751713988987e9331980363e24189ce.dir
      size: 0
      nfiles: 0
    - path: ../src/datas.py
      hash: md5
      md5: 583cf81a900543244c32dc1f336870d3
      size: 10445
    - path: ../src/projection.py
      hash: md5
      md5: 519326ed4e1113e6d31ef685a6734668
      size: 16018
    - path: ../src/steering_inference.py
      hash: md5
      md5: ae4fdaf1bbebeb988c17d9d2435672c6
      size: 6721
    - path: prompts.yaml
      hash: md5
      md5: d2a6b15feb67eb82a4528426ba1a684d
      size: 3629
    params:
      params.yaml:
        prepare:
          seed: 1
          text_data_folder: ../data/text
          prepared_data_folder: ../data/prepared
          output_file_name: inference
          prompt_file: prompts.yaml
        steering:
          evaluation_set:
          - protein
          - celebrity
          - airport
          - medical
          - english_word
          - culture
          - legal
          - french_word
          output_folder: ../data/steered
          experiment_label_name: Qwen2.5-7B-Instruct_all_SPCA_neg80.50.10.0
          verbose: true
          seed: 1
          model_name: Qwen2.5-7B-Instruct
          torch_dtype: torch.bfloat16
          model_path: ../models/Meta-Llama-3-8B-Instruct/
          tokenizer_path: ../models/Meta-Llama-3-8B-Instruct/tokenizer.model
          temperature: 0.5
          top_p: 0.9
          max_seq_len: 256
          max_batch_size: 8
          steeve_type: proj_mean_inv
          vector_path: 
            ../data/projected/Qwen2.5-7B-Instruct_SparsePCAProjectionModel_trained_on_celebrity_vectors_celeb2others.pkl
          layers:
          - 19
          alpha:
          - 1
          beta:
          - -70
          - -60
          - -40
          - -30
          - -20
          - 20
          - 30
          - 40
          - 60
          - 70
          clip_value:
          - 0
          clip_type: soft_clip
          act_space_norm: true
          norm_before_clip: true
          on_prompt: true
          slerp: false
          one_time_steer: false
          manipulation_decay: 1.0
    outs:
    - path: ../data/steered
      hash: md5
      md5: bedc5400e7b6367b767047bcb2c52061.dir
      size: 6075081
      nfiles: 1
  evaluation:
    cmd: torchrun ../src/sentence_similarity.py
    deps:
    - path: ../data/steered
      hash: md5
      md5: bedc5400e7b6367b767047bcb2c52061.dir
      size: 6075081
      nfiles: 1
    - path: ../src/sentence_similarity.py
      hash: md5
      md5: 77bf8a6ba1472caf1db07336b65ee3aa
      size: 12937
    - path: expected_outputs.yaml
      hash: md5
      md5: 9fb1ced0ad2f11c75f4d5f2fdb16f84e
      size: 2104
    - path: few_shot.yaml
      hash: md5
      md5: 0d9464e5f84ce9846baf1bdb7690df76
      size: 7264
    params:
      params.yaml:
        evaluation:
          expected_outputs_path: expected_outputs.yaml
          few_shot_path: few_shot.yaml
          similarity_decision_threshold: 0.1
          seed: 1
          output_folder: ../data/steered_evaluation
          verbose: true
    outs:
    - path: ../data/steered_evaluation
      hash: md5
      md5: 4edd5ef6ca35fbfb54586edef1ee6d11.dir
      size: 6256646
      nfiles: 1
  compile:
    cmd: python ../src/compile_results.py
    deps:
    - path: ../data/steered_evaluation
      hash: md5
      md5: 2c1c62e42a9374c51b82c5219b9d7632.dir
      size: 5051157
      nfiles: 1
    - path: ../src/compile_results.py
      hash: md5
      md5: 2c74f270dd4cfef0c7cef9213966c846
      size: 7478
    params:
      params.yaml:
        compile:
          seed: 0
          compilation_prefix: Qwen2.5-7b-Instruct
          compilation_folder: ../data/compiled
          palette:
          - '#f8c091'
          - '#d0f2ea'
          - '#b5ad98'
          - '#99d5b9'
          - '#e7c7e9'
          - '#d6cfb8'
          - '#f5ffb3'
          - '#ffbd91'
          - '#a9ded8'

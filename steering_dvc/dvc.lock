schema: '2.0'
stages:
  steering:
    cmd: torchrun ../src/steering_inference.py
    deps:
    - path: ../data/features
      hash: md5
      md5: 5b5bdecc3e67c3d19d72678c2b771384.dir
      size: 599546940
      nfiles: 11
    - path: ../src/datas.py
      hash: md5
      md5: ba7918d8bc6b6522a8379d56fa3789c1
      size: 8314
    - path: ../src/steering_inference.py
      hash: md5
      md5: fdc9f309521aab0761a6e84c387d0a63
      size: 5647
    - path: prompts.yaml
      hash: md5
      md5: 248231436d366bef9ca80e141953c3e1
      size: 1263
    params:
      params.yaml:
        prepare:
          seed: 1
          text_data_folder: ../data/text
          prepared_data_folder: ../data/prepared
          output_file_name: inference
          prompt_file: prompts.yaml
        steering:
          evaluation_set:
          - celebrity
          output_folder: ../data/steered
          experiment_label_name: norm_before_softclip2000_onprompt_beta_variation
          verbose: true
          seed: 1
          model_path: ../models/Meta-Llama-3-8B-Instruct/
          tokenizer_path: ../models/Meta-Llama-3-8B-Instruct/tokenizer.model
          temperature: 0.5
          top_p: 0.9
          max_seq_len: 1028
          max_batch_size: 8
          steeve_type: proj_mean_inv
          vector_path: ../data/features/PCA_steeve_celeb->celeb2.pkl
          layers:
          - 16
          alpha:
          - 1
          beta:
          - -15
          - -12
          - -10
          - -8
          - -5
          - -1
          - 1
          - 5
          - 8
          - 10
          - 12
          - 15
          clip_value:
          - 2000
          clip_type: soft_clip
          act_space_norm: true
          norm_before_clip: true
          on_prompt: true
          one_time_steer: false
          manipulation_decay: 1.0
    outs:
    - path: ../data/steered
      hash: md5
      md5: 9ca5d83e2b64b3e1ad993976c1b42c66.dir
      size: 691130
      nfiles: 1
  evaluation:
    cmd: torchrun ../src/sentence_similarity.py
    deps:
    - path: ../data/steered
      hash: md5
      md5: 9ca5d83e2b64b3e1ad993976c1b42c66.dir
      size: 691130
      nfiles: 1
    - path: ../src/sentence_similarity.py
      hash: md5
      md5: 6f9719a62c608a282ff63dbed05f90c7
      size: 13203
    - path: expected_outputs.yaml
      hash: md5
      md5: 0016666f634d4ee201d4576b9b628eac
      size: 2078
    params:
      params.yaml:
        evaluation:
          expected_outputs_path: expected_outputs.yaml
          similarity_decision_threshold: 0.1
          seed: 1
          output_folder: ../data/steered_evaluation
          verbose: true
    outs:
    - path: ../data/steered_evaluation
      hash: md5
      md5: 6a8b1d6ceccc8333a34339ab0d58c40f.dir
      size: 700420
      nfiles: 1
  compile:
    cmd: python ../src/compile_results.py
    deps:
    - path: ../data/steered_evaluation
      hash: md5
      md5: 6a8b1d6ceccc8333a34339ab0d58c40f.dir
      size: 700420
      nfiles: 1
    - path: ../src/compile_results.py
      hash: md5
      md5: 98d0153bbb7eb97bf61a031a4d9cb1f9
      size: 7303
    params:
      params.yaml:
        compile:
          seed: 1
          compilation_prefix: baseline2
          compilation_folder: ../data/compiled
          palette:
          - '#ee6a00'
          - '#eeff41'
          - '#009667'
          - '#cd92d7'
          - '#b3a77d'
          - '#a1e8d9'

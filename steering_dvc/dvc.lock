schema: '2.0'
stages:
  steering:
    cmd: torchrun ../src/steering_inference.py
    deps:
    - path: ../data/features
      hash: md5
      md5: 5893b8af6f4d7ec0a89aa76746d68a60.dir
      size: 662233
      nfiles: 8
    - path: ../src/datas.py
      hash: md5
      md5: 94eaae5bac10f63e3d97304675c895bb
      size: 7843
    - path: ../src/steering_inference.py
      hash: md5
      md5: 3ee023ccc6e440336f50e055c2fc5b4b
      size: 4734
    - path: prompts.yaml
      hash: md5
      md5: 00872dca390a73d79e118d4425f3bb4f
      size: 1069
    params:
      params.yaml:
        prepare:
          seed: 1
          text_data_folder: ../data/text
          prepared_data_folder: ../data/prepared
          output_file_name: inference
          prompt_file: prompts.yaml
        steering:
          evaluation_set:
          - celebrity
          output_folder: ../data/steered
          verbose: true
          seed: 1
          model_path: ../models/Meta-Llama-3-8B-Instruct/
          tokenizer_path: ../models/Meta-Llama-3-8B-Instruct/tokenizer.model
          temperature: 0.5
          top_p: 0.9
          max_seq_len: 64
          max_batch_size: 8
          vector_name: proj+mean+inv
          vector_path: ../data/features/PCAProjectionModel_vectors_center1.pkl
          projection_path: ../data/features/PCAProjectionModel_center1.pkl
          layers:
          - 16
          alpha:
          - -20
          - -10
          - 0
          - 10
          - 20
          beta:
          - 1
          clip_value:
          - 4070
          on_prompt: false
    outs:
    - path: ../data/steered
      hash: md5
      md5: ed41785579d8f51ebcf186337e44cde0.dir
      size: 181581
      nfiles: 1
  evaluation:
    cmd: torchrun ../src/sentence_similarity.py
    deps:
    - path: ../data/steered
      hash: md5
      md5: ed41785579d8f51ebcf186337e44cde0.dir
      size: 181581
      nfiles: 1
    - path: ../src/sentence_similarity.py
      hash: md5
      md5: 6cbe88c57f4c73133db93dcc5786a3f8
      size: 8094
    - path: expected_outputs.yaml
      hash: md5
      md5: b5b10b6637db1f46b5cfc2d14358a762
      size: 2016
    params:
      params.yaml:
        evaluation:
          expected_outputs_path: expected_outputs.yaml
          similarity_decision_threshold: 0.1
          seed: 1
          output_folder: ../data/steered_evaluation
          verbose: true
    outs:
    - path: ../data/steered_evaluation
      hash: md5
      md5: b8ad7aa6ecfbc9f13fd898e3f1654921.dir
      size: 193473
      nfiles: 1
  compile:
    cmd: python ../src/compile_results.py
    deps:
    - path: ../data/steered_evaluation
      hash: md5
      md5: 3d945800076e69eea8ca1bf274183a44.dir
      size: 3515520
      nfiles: 1
    params:
      params.yaml:
        compile:
          seed: 1
          palette:
          - '#ee6a00'
          - '#eeff41'
          - '#009667'
          - '#cd92d7'
          - '#b3a77d'
          - '#a1e8d9'

schema: '2.0'
stages:
  prepare:
    cmd: python src/prepare.py
    deps:
    - path: data/text/
      hash: md5
      md5: fcb14780274b0c4ad22861f8551fadcd.dir
      size: 250422806
      nfiles: 52
    - path: prompts.yaml
      hash: md5
      md5: fae3e87e55e856b410c80553d1471541
      size: 5672
    - path: src/prepare.py
      hash: md5
      md5: 76bfd956399452be1529fd2ac83b377e
      size: 1003
    params:
      params.yaml:
        experiment.data:
        - english_word
        - french_word
        - celebrity
        - airport
        - medical
        - protein
        - culture
        - legal
        prepare:
          seed: 0
          text_data_folder: data/text
          prepared_data_folder: data/prepared
          output_file_name: inference
          prompt_file: prompts.yaml
    outs:
    - path: data/prepared
      hash: md5
      md5: e89eb64a2bfa6eca2ce5ca27e4b2e154.dir
      size: 165596
      nfiles: 8
  inference:
    cmd: python src/inference.py
    deps:
    - path: data/prepared/
      hash: md5
      md5: e89eb64a2bfa6eca2ce5ca27e4b2e154.dir
      size: 165596
      nfiles: 8
    - path: src/inference.py
      hash: md5
      md5: f6c8cb3c60477025a28ac1897934a975
      size: 4765
    params:
      params.yaml:
        experiment.data:
        - english_word
        - french_word
        - celebrity
        - airport
        - medical
        - protein
        - culture
        - legal
        inference:
          seed: 1
          model_name: Qwen2.5-7B-Instruct
          model_path: models/Meta-Llama-3-8B-Instruct/
          tokenizer_path: models/Meta-Llama-3-8B-Instruct/tokenizer.model
          torch_dtype: torch.bfloat16
          temperature: 0.6
          top_p: 0.9
          max_seq_len: 512
          max_batch_size: 8
          generation_verbose: true
          inference_data_folder: data/inference
          prompt_token: true
          token_places: first_gen
          layers:
          - 19
          save_input_token: true
  detection:
    cmd: python src/detection.py
    deps:
    - path: data/projected/
      hash: md5
      md5: ec78d73de9b1ed51bc2489ab4f128d4c.dir
      size: 179743289
      nfiles: 38
    - path: src/detection.py
      hash: md5
      md5: 3075d9806f574dac9fc8635dcd32e3cb
      size: 5686
    params:
      params.yaml:
        detection:
          seed: 1
          detection_data_folder: data/detection
          detection_model_path: models/detection/
          detection_models:
            SGDDetectionModel:
              max_iter: 5
              loss: log_loss
        experiment.split:
          training_data:
          - celebrity
          testing_data:
          - english_word
          - french_word
          - airport
          - medical
          - protein
          - culture
          - legal
    outs:
    - path: data/detection
      hash: md5
      md5: df9f18ffa4bc392a621fd6fbc4bfe7e4.dir
      size: 2002191
      nfiles: 8
    - path: models/detection
      hash: md5
      md5: 0e788347919630a4fb28ca2a3dad59d3.dir
      size: 1250
      nfiles: 1
  projection:
    cmd: python src/projection.py
    deps:
    - path: data/inference/
      hash: md5
      md5: f37e3140200c5614554115a7e5bdfa07.dir
      size: 536928174
      nfiles: 25
    - path: src/probes.py
      hash: md5
      md5: 3a526b8a2b836242a6051dce9a565a02
      size: 5855
    - path: src/projection.py
      hash: md5
      md5: 519326ed4e1113e6d31ef685a6734668
      size: 16018
    params:
      params.yaml:
        experiment.split:
          training_data:
          - celebrity
          testing_data:
          - english_word
          - french_word
          - airport
          - medical
          - protein
          - culture
          - legal
        projection:
          seed: 0
          projection_data_folder: data/projected
          projection_model_path: models/projection/
          zero_centered: true
          slerp_interpolation: false
          first_gen: true
          proj_layer: 0
          projections:
            SparsePCAProjectionModel:
              n_components: 2
              alpha: 0.2
  evaluation:
    cmd: python src/evaluation.py
    deps:
    - path: data/projected/
      hash: md5
      md5: ec78d73de9b1ed51bc2489ab4f128d4c.dir
      size: 179743289
      nfiles: 38
    - path: models/detection
      hash: md5
      md5: 0e788347919630a4fb28ca2a3dad59d3.dir
      size: 1250
      nfiles: 1
    - path: src/evaluation.py
      hash: md5
      md5: 1e3c85143b8a01257233d422c62cdc2c
      size: 8767
    params:
      params.yaml:
        evaluation:
          evaluation_folder: eval/
          seed: 1
        experiment.split:
          training_data:
          - celebrity
          testing_data:
          - english_word
          - french_word
          - airport
          - medical
          - protein
          - culture
          - legal
    outs:
    - path: eval
      hash: md5
      md5: 71c9ff26b61a19fb24135c83fe01bcb2.dir
      size: 3913216
      nfiles: 10

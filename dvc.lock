schema: '2.0'
stages:
  prepare:
    cmd: python src/prepare.py
    deps:
    - path: data/text/
      hash: md5
      md5: b607a93b28efbe52ae7dc2244325cad9.dir
      size: 1013455
      nfiles: 44
    - path: prompts.yaml
      hash: md5
      md5: df49cf93c6b31a6b3b81edb00ff5aff4
      size: 5315
    - path: src/prepare.py
      hash: md5
      md5: 76bfd956399452be1529fd2ac83b377e
      size: 1003
    params:
      params.yaml:
        experiment.data:
        - poem
        prepare:
          seed: 1
          text_data_folder: data/text
          prepared_data_folder: data/prepared
          output_file_name: inference
          prompt_file: prompts.yaml
    outs:
    - path: data/prepared
      hash: md5
      md5: 600fd18e11a11ebec01b56b3a158affe.dir
      size: 3424
      nfiles: 1
  inference:
    cmd: torchrun src/inference.py
    deps:
    - path: data/prepared/
      hash: md5
      md5: 600fd18e11a11ebec01b56b3a158affe.dir
      size: 3424
      nfiles: 1
    - path: src/inference.py
      hash: md5
      md5: 651bdb1858c3ccbddad7df8db0f594e0
      size: 7669
    params:
      params.yaml:
        experiment.data:
        - poem
        inference:
          seed: 1
          model_path: models/Meta-Llama-3-8B-Instruct/
          tokenizer_path: models/Meta-Llama-3-8B-Instruct/tokenizer.model
          temperature: 0.5
          top_p: 0.9
          max_seq_len: 512
          max_batch_size: 8
          generation_verbose: true
          inference_data_folder: data/inference
          prompt_token: true
          token_places: all
          layers: all
          save_input_token: true
    outs:
    - path: data/inference
      hash: md5
      md5: 5d36b81ca3e9ab1636ce209476451bcd.dir
      size: 12234764903
      nfiles: 2
  detection:
    cmd: python src/detection.py
    deps:
    - path: data/projected/
      hash: md5
      md5: b742e4658830078aef44aa9bebc47765.dir
      size: 241823652
      nfiles: 2
    - path: src/detection.py
      hash: md5
      md5: 5860917a2d473c1ead16ed3e87e3fb96
      size: 4479
    params:
      params.yaml:
        detection:
          seed: 1
          detection_data_folder: data/detection
          detection_model_path: models/detection/
          detection_models:
            SVCDetectionModel:
              max_iter: 100
              probability: true
        experiment.split:
          training_data:
          - culture
          testing_data:
          - culture
    outs:
    - path: data/detection
      hash: md5
      md5: 73398b3869b74a6bed7b6c70aad40425.dir
      size: 236205126
      nfiles: 1
    - path: models/detection
      hash: md5
      md5: 22dbe3904a2e0313752525edb26b361d.dir
      size: 4456
      nfiles: 1
  projection:
    cmd: python src/projection.py
    deps:
    - path: data/inference/
      hash: md5
      md5: 5d36b81ca3e9ab1636ce209476451bcd.dir
      size: 12234764903
      nfiles: 2
    - path: src/projection.py
      hash: md5
      md5: 64637600aacffa124f7bb4554d004c23
      size: 8156
    params:
      params.yaml:
        experiment.split:
          training_data:
          - poem
          testing_data:
          - poem
        projection:
          seed: 1
          projection_data_folder: data/projected
          projection_model_path: models/projection/
          zero_centered: true
          projections:
            SparsePCAProjectionModel:
              n_components: 2
              alpha: 0.1
    outs:
    - path: data/projected
      hash: md5
      md5: 46d565cdb4eb0d938a717e9098d2fbf0.dir
      size: 299325061
      nfiles: 2
    - path: models/projection
      hash: md5
      md5: cbdbfd64a0e798d0e897bb2682ae66e7.dir
      size: 99167
      nfiles: 1
  evaluation:
    cmd: python src/evaluation.py
    deps:
    - path: data/projected/
      hash: md5
      md5: b742e4658830078aef44aa9bebc47765.dir
      size: 241823652
      nfiles: 2
    - path: models/detection
      hash: md5
      md5: 22dbe3904a2e0313752525edb26b361d.dir
      size: 4456
      nfiles: 1
    - path: src/evaluation.py
      hash: md5
      md5: 364c2b3f0bffca03c94e2886bb8f9a4a
      size: 7093
    params:
      params.yaml:
        evaluation:
          evaluation_folder: eval/
          seed: 1
        experiment.split:
          training_data:
          - culture
          testing_data:
          - culture
    outs:
    - path: eval
      hash: md5
      md5: 7b1c2e45e49ee60e012504ebe88adf4d.dir
      size: 3736853
      nfiles: 10

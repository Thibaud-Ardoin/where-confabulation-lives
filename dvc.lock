schema: '2.0'
stages:
  prepare:
    cmd: python src/prepare.py
    deps:
    - path: data/text/
      hash: md5
      md5: 4a8a1d1074780fa79fc6ecc01d5ceda4.dir
      size: 109117
      nfiles: 33
    - path: prompts.yaml
      hash: md5
      md5: c458f9f51dc3a544281ddfebcfcf9938
      size: 3848
    - path: src/prepare.py
      hash: md5
      md5: 76bfd956399452be1529fd2ac83b377e
      size: 1003
    params:
      params.yaml:
        experiment.data:
        - celebrity
        - english_word
        prepare:
          seed: 1
          text_data_folder: data/text
          prepared_data_folder: data/prepared
          output_file_name: inference
          prompt_file: prompts.yaml
    outs:
    - path: data/prepared
      hash: md5
      md5: 8eff18b5620dcb703c3c4d320dec42ff.dir
      size: 26253
      nfiles: 2
  inference:
    cmd: torchrun src/inference.py
    deps:
    - path: data/prepared/
      hash: md5
      md5: 8eff18b5620dcb703c3c4d320dec42ff.dir
      size: 26253
      nfiles: 2
    - path: src/inference.py
      hash: md5
      md5: 9f8c279e72bdde8c6842f2ee8f80795e
      size: 7667
    params:
      params.yaml:
        experiment.data:
        - celebrity
        - english_word
        inference:
          seed: 1
          model_path: models/Meta-Llama-3-8B-Instruct/
          tokenizer_path: models/Meta-Llama-3-8B-Instruct/tokenizer.model
          temperature: 0.5
          top_p: 0.9
          max_seq_len: 512
          max_batch_size: 8
          generation_verbose: false
          inference_data_folder: data/inference
          prompt_token: true
          token_places: all
          layers:
          - 16
          save_input_token: true
    outs:
    - path: data/inference
      hash: md5
      md5: 9a856c3deb92c1b2228e99bb8e4678d5.dir
      size: 4829281997
      nfiles: 4
  detection:
    cmd: python src/detection.py
    deps:
    - path: data/projected/
      hash: md5
      md5: 5ea3b3d01cba056ed362763bcac8cddb.dir
      size: 188604207
      nfiles: 3
    - path: src/detection.py
      hash: md5
      md5: 5860917a2d473c1ead16ed3e87e3fb96
      size: 4479
    params:
      params.yaml:
        detection:
          seed: 1
          detection_data_folder: data/detection
          detection_model_path: models/detection/
          detection_models:
            SVCDetectionModel:
              max_iter: 100
              probability: true
        experiment.split:
          training_data:
          - english_word
          testing_data:
          - celebrity
    outs:
    - path: data/detection
      hash: md5
      md5: 2ae17ddecd5b023f05a83accacb4e5f8.dir
      size: 188545290
      nfiles: 2
    - path: models/detection
      hash: md5
      md5: 030f0d13079ff0f15413c702dbe65306.dir
      size: 1996
      nfiles: 1
  projection:
    cmd: python src/projection.py
    deps:
    - path: data/inference/
      hash: md5
      md5: 9a856c3deb92c1b2228e99bb8e4678d5.dir
      size: 4829281997
      nfiles: 4
    - path: src/projection.py
      hash: md5
      md5: 706944311fe17a58b8ae31888363cc4b
      size: 5528
    params:
      params.yaml:
        experiment.split:
          training_data:
          - english_word
          testing_data:
          - celebrity
        projection:
          seed: 1
          projection_data_folder: data/projected
          projection_model_path: models/projection/
          zero_centered: true
          projections:
            PCAProjectionModel:
              n_components: 2
          steering_vector:
          - proj+mean+inv
    outs:
    - path: data/projected
      hash: md5
      md5: 5ea3b3d01cba056ed362763bcac8cddb.dir
      size: 188604207
      nfiles: 3
    - path: models/projection
      hash: md5
      md5: aa04ee3ad2a6238dc50d71e0b889ddd6.dir
      size: 99383
      nfiles: 1
  evaluation:
    cmd: python src/evaluation.py
    deps:
    - path: data/projected/
      hash: md5
      md5: 5ea3b3d01cba056ed362763bcac8cddb.dir
      size: 188604207
      nfiles: 3
    - path: models/detection
      hash: md5
      md5: 030f0d13079ff0f15413c702dbe65306.dir
      size: 1996
      nfiles: 1
    - path: src/evaluation.py
      hash: md5
      md5: 9b35c0bffd067bd0dbe372bff86e2b9f
      size: 6729
    params:
      params.yaml:
        evaluation:
          evaluation_folder: eval/
          seed: 1
        experiment.split:
          training_data:
          - english_word
          testing_data:
          - celebrity
    outs:
    - path: eval
      hash: md5
      md5: 856368401c17e5e0020ddd284a1fe91a.dir
      size: 3705500
      nfiles: 10
